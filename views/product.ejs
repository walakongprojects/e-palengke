<% include ./partials/header %>


<!-- <h1 class="display-4 mb-4"><%= product.title %></h1>

<div class="row">
    
    
    <div class="col-sm-12 col-md-5">
        <img class="spi" src="/product_images/<%= product.id %>/<%= product.image %>" alt="">
        <br>
    </div>
    <div class="col-sm-12 col-md-7">
        <p><%= product.description %></p>
        <p>&#8369;<%= parseFloat(product.price).toFixed(2) %></p>
        <% if(product.quantity) {%>
        <p>Quantity: <%= product.quantity %></p>
        <p><a href="/cart/add/<%= product.slug %>">Add to cart</a></p>
        <% } else { %>
        <p><strong>Out of Stock</strong></p>
        <% } %>

    </div>
    <div class="col-sm-12">
        <ul class="gallery">
            <% galleryImages.forEach(image => { %>
                <% if (image != "thumbs") { %>
                <li>
                    <a data-fancybox="gallery" href="/product_images/<%= product.id %>/gallery/<%= image %>">
                        <img class="hvr-glow" src="/product_images/<%= product.id %>/gallery/thumbs/<%= image %>" alt="">
                    </a>
                </li>
                <% } %>
            <% }); %>
        </ul>
    </div>
</div>
<div class="row">
  
</div> -->


<!-- ///////////////////// -->


<!-- Start main Content -->
<div class="maincontent bg--white pt--80 pb--55">
        <div class="container">
            <div class="row">
                <div class="col-lg-9 col-12">
                    <div class="wn__single__product">
                        <div class="row">
                            <div class="col-lg-6 col-12">
                                <div class="wn__fotorama__wrapper">
                                    <!-- <div class="fotorama wn__fotorama__action" data-nav="thumbs">
                                        <% galleryImages.forEach(image => { %>
                                            <% if (image != "thumbs") { %>
                                            <li>
                                                <a href="/product_images/<%= product.id %>/gallery/<%= image %>"><img src="/product_images/<%= product.id %>/gallery/thumbs/<%= image %>" ></a>
                                            </li>
                                        <% } %>
                                        <% }); %>
                                    </div> -->
                                    <div class="">
                                        <img class="spi" src="/product_images/<%= product.id %>/<%= product.image %>" alt="">
                                        <br>
                                    </div>
                                    <div class="">
                                        <ul class="gallery">
                                            <% galleryImages.forEach(image => { %>
                                                <% if (image != "thumbs") { %>
                                                <li>
                                                    <!-- <a data-fancybox="gallery" href="/product_images/<%= product.id %>/gallery/<%= image %>"> -->
                                                        <img class="" src="/product_images/<%= product.id %>/gallery/thumbs/<%= image %>" alt="">
                                                    <!-- </a> -->
                                                </li>
                                                <% } %>
                                            <% }); %>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-12">
                                <div class="product__info__main">
                                    <h1><%= product.title%></h1>
                                    <div class="product-reviews-summary d-flex">
                                        <ul class="rating-summary d-flex">
                                            <li><i class="zmdi zmdi-star-outline"></i></li>
                                            <li><i class="zmdi zmdi-star-outline"></i></li>
                                            <li><i class="zmdi zmdi-star-outline"></i></li>
                                            <li class="off"><i class="zmdi zmdi-star-outline"></i></li>
                                            <li class="off"><i class="zmdi zmdi-star-outline"></i></li>
                                        </ul>
                                    </div>
                                    <div class="price-box">
                                        <span>&#8369;<%= parseFloat(product.price).toFixed(2) %></span>
                                    </div>
                                    <div class="product__overview">
                                        <p><%= product.description %></p>
                                    </div>
                                    <div class="box-tocart ">

                                        <span>Quantity <%= product.quantity %></span>

                                        <div class="addtocart__actions">
                                            <a class="tocart" href="/cart/add/<%= product.slug %>" title="Add to Cart">Add to Cart</a>
                                            <% if (product.enableBidding && userCurrentBid === null && currentUser) { %>
                                                <a class="tocart" data-toggle="modal" data-target="#bid">Bid</button>
                                            <% } else if (product.enableBidding && userCurrentBid !== null) { %>
                                                <a class="tocart" data-toggle="modal" data-target="#bid">Edit Bid</button>
                                            <% } else { %>
                                            <% } %>
                                        </div>
                                        
                                    </div>
                                    <div class="product_meta">
                                        <span class="posted_in">Category: 
                                            <a href="/products/<%= product.category %>"><%= product.category %></a>, 
                                        </span>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="product__info__detailed">
                        <div class="pro_details_nav nav justify-content-start" role="tablist">
                            <a class="nav-item nav-link active" data-toggle="tab" href="#nav-details" role="tab">Details</a>
                        </div>
                        <div class="tab__container">
                            <!-- Start Single Tab Content -->
                            <div class="pro__tab_label tab-pane fade show active" id="nav-details" role="tabpanel">
                                <div class="description__attribute">
                                    <%= product.description %>
                                </div>
                            </div>
                            <!-- End Single Tab Content -->
                        </div>
                    </div>


                    <div class="wn__related__product pt--80 pb--50">
                        <div class="section__title text-center">
                            <h2 class="title__be--2">Related Products</h2>
                        </div>
                        <div class="row mt--60">
                            <div class="productcategory__slide--2 arrows_style owl-carousel owl-theme">
                                <!-- Start Single Product -->
                                <% products.forEach(productOne => { %>
                                <!-- Start Single Product -->
                                    <div class="product product__style--3 col-lg-4 col-md-4 col-sm-6 col-12">
                                    <div class="product__thumb">
                                        <a class="first__img" href="/products/<%= productOne.category %>/<%= productOne.slug %>"><img src="/product_images/<%= productOne.id %>/<%= productOne.image %>" alt="product image"></a>
                                        <a class="second__img animation1" href="/products/<%= productOne.category %>/<%= productOne.slug %>"><img src="/product_images/<%= productOne.id %>/<%= productOne.image %>" alt="product image"></a>
                                    <!-- <div class="hot__box">
                                    <span class="hot-label">BEST SALLER</span>
                                    </div> -->
                                </div>
                                <div class="product__content content--center">
                                    <h4><a href="/products/<%= productOne.category %>/<%= productOne.slug %>"><%= productOne.title %></a></h4>
                                    <ul class="prize d-flex">
                                    <li>&#8369;<%= parseFloat(productOne.price).toFixed(2) %></li>
                                    </ul>
                                    <div class="action">
                                    <div class="actions_inner">
                                        <ul class="add_to_links">
                                        <li><a class="cart" title="Add to cart" href="/cart/add-by-id/<%= productOne._id %>"><i class="bi bi-shopping-bag4"></i></a></li>
                                        <li><a class="compare" title="Quantity" href="/products/<%= productOne.category %>/<%= productOne.slug %>"><i class=""><%= productOne.quantity %></i></a></li>
                                        <li><a data-toggle="modal" title="Quick View" class="quickview modal-view detail-link" href="#<%=productOne.slug%>"><i class="bi bi-search"></i></a></li>
                                        </ul>
                                    </div>
                                    </div>
                                </div>
                                    </div>
                                <!-- End Single Product -->
                                <% }) %>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- insert sidebar here -->
                <% include ./partials/sidebar %>
                <% include ./partials/sidebarend %>
            </div>
        </div>
    </div>
    <!-- End main Content -->

<!-- QUICKVIEW PRODUCT -->
<div id="quickview-wrapper">
    <!-- Modal -->
    <% products.forEach(productOne => { %>
    <div class="modal fade" id="<%= productOne.slug %>" tabindex="-1" role="dialog">
        <div class="modal-dialog modal__container" role="document">
            <div class="modal-content">
                <div class="modal-header modal__header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="modal-product">
                        <!-- Start product images -->
                        <div class="product-images">
                            <div class="main-image images">
                                <img alt="big images" src="/product_images/<%= productOne.id %>/<%= productOne.image %>">
                            </div>
                        </div>
                        <!-- end product images -->
                        <div class="product-info">
                            <h1><%= productOne.title %></h1>
                            <div class="price-box-3">
                                <div class="s-price-box">
                                    <span class="new-price">&#8369;<%= parseFloat(productOne.price).toFixed(2) %></span>
                                </div>
                            </div>
                            <div class="quick-desc">
                                <%= productOne.description %>
                            </div>
                            <span>Quantity: <%= productOne.quantity %></span>
                            <div class="addtocart-btn">
                                <a href="/cart/add-by-id/<%= productOne._id %>">Add to cart</a>
                            </div>
                        </div><!-- .product-info -->
                    </div><!-- .modal-product -->
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div>
    <!-- END Modal -->
    <% }) %>
    </div>
    <!-- END QUICKVIEW PRODUCT -->

<!-- BID PRODUCT -->
<div id="bid-wrapper">
    <!-- Modal -->
    <div class="modal fade" id="bid" tabindex="-1" role="dialog">
        <div class="modal-dialog modal__container" role="document">
            <div class="modal-content">
                <div class="modal-header modal__header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="modal-product">
                        <!-- Start product images -->
                        <div class="product-images">
                            <div class="main-image images">
                                <img alt="big images" src="/product_images/<%= product.id %>/<%= product.image %>">
                            </div>
                        </div>
                        <!-- end product images -->
                        <div class="product-info">
                            <h1><%= product.title %></h1>
                            <div class="price-box-3">
                                <div class="s-price-box">
                                    <span class="new-price">&#8369;<%= parseFloat(product.price).toFixed(2) %></span>
                                </div>
                            </div>
                            <div class="quick-desc">
                                <%= product.description %>
                            </div>
                            <span>Quantity: <%= product.quantity %></span>
                            <% if (userCurrentBid === null) { %>
                                <form action="/bid" method="POST" enctype="multipart/form-data">
                                    <div class="form-group mt-4">
                                        <label for="price">Amount</label>
                                        <input type="number" name="price" class="form-control" id="price" placeholder="Amount">
                                        <small id="price" class="form-text text-muted">Place your bid amount.</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity">Quantity</label>
                                        <input type="number" class="form-control" name="quantity" id="quantity" placeholder="Quantity">
                                    </div>
                                    <input type="hidden" name="productId" id="productId" value="<%= product._id %>" />
                                    <div class="">
                                        <button class="btn btn-primary" type="submit">Submit Bid</button>
                                    </div>
                                </form>
                            <% } else { %>
                                <form action="/bid/edit/<%= userCurrentBid._id %>" method="POST" enctype="multipart/form-data">
                                    <h2>sad</h2>
                                    <div class="form-group mt-4">
                                        <label for="price">Amount</label>
                                        <input type="number" value="<%= parseFloat(userCurrentBid.price).toFixed(2) %>" name="price" class="form-control" id="price" placeholder="Amount">
                                        <small id="price"  class="form-text text-muted">Place your bid amount.</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity">Quantity</label>
                                        <input type="number" value="<%= userCurrentBid.quantity %>" class="form-control" name="quantity" id="quantity" placeholder="Quantity">
                                    </div>
                                    <input type="hidden" name="productId" id="productId" value="<%= product._id %>" />
                                    <div class="">
                                        <button class="btn btn-primary" type="submit">Update Bid</button>
                                    </div>
                                </form>
                                <form class="mt-2" action="/bid/delete/<%= userCurrentBid._id %>" method="POST" enctype="multipart/form-data">
                                    <button class="btn btn-danger" type="submit">Cancel Bid</button>
                                </form>
                            <% } %>
                        </div><!-- .product-info -->
                    </div><!-- .modal-product -->
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div>
    <!-- END Modal -->
  </div>
  <!-- END BID PRODUCT -->
</div>

    
<% include ./partials/footer %>
